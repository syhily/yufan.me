---
import config from '@/blog.config'
import { getPosts, tags } from '@/helpers/content/schema'
import PostsLayout from '@/layouts/posts/PostsLayout.astro'

const { num } = Astro.params

if (!num) {
  Astro.response.status = 500
  throw new Error('No such page num existed.')
}

const pageNum = Number.parseInt(num)
if (pageNum <= 1) {
  return Astro.redirect('/')
}

const visiblePosts = getPosts({ hidden: false, schedule: false })
const total = Math.ceil(visiblePosts.length / config.settings.pagination.posts)
if (pageNum > total) {
  return Astro.redirect(`${total}`, 302)
}
---

<PostsLayout posts={visiblePosts} {pageNum} {tags} />
