---
import type { Post } from '@/helpers/content/schema'
import { joinPaths } from '@astrojs/internal-helpers/path'
import { Image } from 'astro:assets'
import config from '@/blog.config'
import Comments from '@/components/comment/Comments.astro'
import LikeButton from '@/components/like/LikeButton.astro'
import LikeShare from '@/components/like/LikeShare.astro'
import MusicPlayer from '@/components/mdx/music/MusicPlayer.astro'
import Solution from '@/components/mdx/solutions/Solution.astro'
import PostMeta from '@/components/meta/PostMeta.astro'
import TableOfContents from '@/components/page/toc/TableOfContents.astro'
import Sidebar from '@/components/sidebar/Sidebar.astro'
import { formatLocalDate } from '@/helpers/content/formatter'
import { getPosts, getTag, tags } from '@/helpers/content/schema'
import BaseLayout from '@/layouts/BaseLayout.astro'

interface Props {
  post: Post
}

const { post } = Astro.props
const { Content, headings } = await post.render()
---

<BaseLayout title={post.title}>
  <PostMeta
    slot="og"
    title={post.title}
    description={post.summary}
    requestPath={post.permalink}
    ogImageUrl={post.og ? post.og : `/images/og/${post.slug}.png`}
    ogImageAltText={post.title}
    article={post}
  />
  <div class="lg:px-2 2xl:px-5 py-3 md:py-4 2xl:py-5">
    <div class="container mx-auto px-4">
      <div class="flex flex-wrap">
        <div class="content-wrapper w-full xl:w-9/12">
          <div class="post card card-md">
            <div class="card-body">
              <h1 class="post-title">{post.title}</h1>
              <div class="post-meta text-sm text-muted mt-3 mb-4">
                <time class="">{formatLocalDate(post.date, 'yyyy-MM-dd HH:mm')}</time>
                {
                  post.tags.length > 0 &&
                    post.tags
                      .map((tag) => getTag(tag, undefined))
                      .filter((tag) => tag !== undefined)
                      .map((tag) => (
                        <>
                          <a class="float-right ml-2 badge badge-light badge-pill" href={`/tags/${tag.slug}`}>
                            {tag.name}
                          </a>
                        </>
                      ))
                }
              </div>
              <TableOfContents {headings} toc={post.toc} />
              <div class="post-content">
                <Content components={{ img: Image, MusicPlayer, Solution }} />
              </div>
              <LikeButton permalink={post.permalink} />
              <LikeShare {post} />
              {
                post.comments && (
                  <Comments commentKey={joinPaths(config.website, post.permalink, '/')} title={post.title} />
                )
              }
            </div>
          </div>
        </div>
        <Sidebar posts={getPosts({ hidden: false, schedule: false })} {tags} />
      </div>
    </div>
  </div>
</BaseLayout>
