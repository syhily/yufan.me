---
import options from '@/options';
import { DateTime } from 'luxon';

const loadCalendarImage = async (): Promise<string> => {
  const now = DateTime.now().setZone(options.settings.timeZone);
  const link = `https://img.owspace.com/Public/uploads/Download/${now.year}/${now.toFormat('LLdd')}.jpg`;
  const response = await fetch(link, {
    referrer: '',
  });

  if (!response.ok) {
    console.error(`Failed to fetch image ${link}`);
    return '';
  }

  const encodedImage = Buffer.from(await response.arrayBuffer()).toString('base64');
  return `data:image/jpeg;base64,${encodedImage}`;
};

const calendarImage = !options.settings.sidebar.calendar ? '' : await loadCalendarImage();
---

{
  calendarImage !== '' && (
    <div class="widget widget-owspace-calendar">
      <img src={calendarImage} />
    </div>
  )
}
