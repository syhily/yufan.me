---
interface Props {
    title: string
    src: string
}

const { title, src } = Astro.props
---
<div class="pdf-viewer" data-src={src} data-title={title}></div>

<script>
import type { I18nPlugin } from '@embedpdf/plugin-i18n'
import type { Locale } from '@embedpdf/snippet'
import EmbedPDF, { ZoomMode } from '@embedpdf/snippet'

const chinese = {
  code: 'zh',
  name: '中文',
  translations: {
    comments: {
      emptyState: '未找到结果',
    },
    zoom: {
      in: '放大',
      out: '缩小',
      fitWidth: '适合宽度',
      fitPage: '适合页面',
      marquee: '框选缩放',
      automatic: '自动',
      level: '缩放级别（{level}%）',
      inArea: '区域放大',
      menu: '缩放菜单',
    },
    pan: {
      toggle: '切换平移模式',
    },
    pointer: {
      toggle: '切换指针模式',
    },
    capture: {
      screenshot: '截图',
    },
    document: {
      menu: '文档菜单',
      open: '打开',
      close: '关闭',
      print: '打印',
      export: '导出',
      properties: '属性',
      fullscreen: '全屏',
    },
    panel: {
      sidebar: '侧边栏',
      search: '搜索',
      comment: '评论',
      thumbnails: '缩略图',
      outline: '大纲',
      annotationStyle: '批注样式',
    },
    page: {
      settings: '页面设置',
      single: '单页',
      twoOdd: '双页（奇数页在右）',
      twoEven: '双页（偶数页在右）',
      vertical: '垂直',
      horizontal: '水平',
      spreadMode: '展开模式',
      scrollLayout: '滚动布局',
      rotation: '页面旋转',
    },
    rotate: {
      clockwise: '顺时针旋转',
      counterClockwise: '逆时针旋转',
    },
    mode: {
      view: '查看',
      annotate: '批注',
      shapes: '图形',
      redact: '遮盖',
    },
    tabs: {
      overflowMenu: '更多标签',
    },
    annotation: {
      text: '文本',
      highlight: '高亮',
      strikeout: '删除线',
      underline: '下划线',
      rectangle: '矩形',
      circle: '圆形',
      line: '直线',
      arrow: '箭头',
      polygon: '多边形',
      polyline: '折线',
      ink: '手写',
      stamp: '印章',
      overflowTools: '更多工具',
    },
    redaction: {
      area: '区域遮盖',
      text: '文本遮盖',
      applyAll: '全部应用',
      clearAll: '全部清除',
    },
    history: {
      undo: '撤销',
      redo: '重做',
    },
    outline: {
      noOutline: '无目录',
      noBookmarks: '无书签',
    },
    search: {
      title: '搜索',
      placeholder: '搜索',
      close: '关闭搜索',
      caseSensitive: '区分大小写',
      wholeWord: '全字匹配',
      resultsFound: '找到 {count} 个结果',
      previousResult: '上一个结果',
      nextResult: '下一个结果',
      page: '第 {page} 页',
    },
  },
} satisfies Locale

document.querySelectorAll('.pdf-viewer').forEach(async (container) => {
  if (container instanceof HTMLElement) {
    const instance = EmbedPDF.init({
      type: 'container',
      target: container,
      src: container.dataset.src,
      theme: { preference: 'system' },
      zoom: {
        defaultZoomLevel: ZoomMode.FitWidth,
      },
      i18n: {
        fallbackLocale: 'en',
      },
    })
    const registry = await instance?.registry
    if (registry) {
      const i18n = registry.getPlugin<I18nPlugin>('i18n')?.provides()
      if (i18n !== null) {
        i18n?.registerLocale(chinese)
        i18n?.setLocale('zh')
      }
    }
  }
})
</script>
