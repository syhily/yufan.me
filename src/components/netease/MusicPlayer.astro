---
import 'aplayer-ts/src/css/base.css'
import { resolveSongURL, type MusicPlayerProps } from './resolver'

interface Props extends MusicPlayerProps {}

const { name, artist, pic, lyric } = Astro.props
const url = await resolveSongURL(Astro.props)
---

{
  name !== '' && artist !== '' && url !== '' && pic !== '' && lyric !== '' && (
    <div
      class="aplayer"
      data-id={Astro.props.netease}
      data-name={name}
      data-artist={artist}
      data-url={url}
      data-cover={pic}
      data-lyric={lyric}
    >
      音乐正在加载中 ...
    </div>
  )
}

<script>
  import APlayer from 'aplayer-ts'

  for (const p of document.querySelectorAll(`.aplayer`)) {
    const e = p as HTMLElement
    APlayer().init({
      container: e,
      lrcType: 1,
      audio: [
        {
          name: e.dataset.name,
          artist: e.dataset.artist,
          url: e.dataset.url,
          cover: e.dataset.cover,
          theme: '#6dd7de',
          lrc: e.dataset.lyric,
        },
      ],
    })
  }
</script>
